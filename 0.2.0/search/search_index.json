{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Django Prefetch Values","text":"<p>Enable <code>.prefetch_related().values()</code> in Django ORM - returns nested dicts with prefetched relations instead of model instances.</p> <p>This package solves Django ticket #26565, which has been open since 2016.</p>"},{"location":"#quick-example","title":"Quick Example","text":"<pre><code>from django_prefetch_values import PrefetchValuesQuerySet\n\nclass Book(models.Model):\n    title = models.CharField(max_length=200)\n    authors = models.ManyToManyField(\"Author\")\n\n    objects = PrefetchValuesQuerySet.as_manager()\n\n# Returns dicts with nested prefetched data\nbooks = Book.objects.prefetch_related(\"authors\").values()\n# [{\"id\": 1, \"title\": \"Book 1\", \"authors\": [{\"id\": 1, \"name\": \"Author 1\"}, ...]}, ...]\n</code></pre>"},{"location":"#performance","title":"Performance","text":"<p>For list endpoints with large page sizes (e.g., 1000 items) and multiple relations:</p> Approach Time Standard Django ~130ms django-prefetch-values ~28ms"},{"location":"#requirements","title":"Requirements","text":"<ul> <li>Python 3.13+</li> <li>Django 6.0+</li> </ul>"},{"location":"getting-started/installation/","title":"Installation","text":""},{"location":"getting-started/installation/#requirements","title":"Requirements","text":"<ul> <li>Python 3.13+</li> <li>Django 6.0+</li> </ul>"},{"location":"getting-started/installation/#install-from-pypi","title":"Install from PyPI","text":"<pre><code>pip install django-prefetch-values\n</code></pre> <p>Or with uv:</p> <pre><code>uv add django-prefetch-values\n</code></pre>"},{"location":"getting-started/installation/#development-installation","title":"Development Installation","text":"<pre><code>git clone https://github.com/oliverhaas/django-prefetch-values.git\ncd django-prefetch-values\nuv venv\nuv sync --group dev\n</code></pre>"},{"location":"getting-started/quickstart/","title":"Quick Start","text":""},{"location":"getting-started/quickstart/#setup","title":"Setup","text":"<p>Add <code>PrefetchValuesQuerySet</code> as your model's manager:</p> <pre><code>from django.db import models\nfrom django_prefetch_values import PrefetchValuesQuerySet\n\n\nclass Author(models.Model):\n    name = models.CharField(max_length=100)\n\n    objects = PrefetchValuesQuerySet.as_manager()\n\n\nclass Book(models.Model):\n    title = models.CharField(max_length=200)\n    authors = models.ManyToManyField(Author, related_name=\"books\")\n\n    objects = PrefetchValuesQuerySet.as_manager()\n</code></pre>"},{"location":"getting-started/quickstart/#usage","title":"Usage","text":"<pre><code># Standard Django - prefetch_related is IGNORED with values()\nbooks = Book.objects.prefetch_related(\"authors\").values()\n# [{\"id\": 1, \"title\": \"Book 1\"}, ...]  # No authors!\n\n# With django-prefetch-values - prefetched data is included\nbooks = Book.objects.prefetch_related(\"authors\").values()\n# [{\"id\": 1, \"title\": \"Book 1\", \"authors\": [{\"id\": 1, \"name\": \"Author 1\"}, ...]}, ...]\n</code></pre>"},{"location":"getting-started/quickstart/#supported-relations","title":"Supported Relations","text":"<ul> <li>ManyToMany: <code>Book.objects.prefetch_related(\"authors\").values()</code></li> <li>Reverse ForeignKey: <code>Author.objects.prefetch_related(\"books\").values()</code></li> <li>Nested: <code>Publisher.objects.prefetch_related(Prefetch(\"books\", queryset=Book.objects.prefetch_related(\"authors\"))).values()</code></li> </ul>"},{"location":"getting-started/quickstart/#prefetch-objects","title":"Prefetch Objects","text":"<pre><code>from django.db.models import Prefetch\n\n# Filter prefetched data\nBook.objects.prefetch_related(\n    Prefetch(\"authors\", queryset=Author.objects.filter(name__startswith=\"A\"))\n).values()\n\n# Custom to_attr\nBook.objects.prefetch_related(\n    Prefetch(\"authors\", to_attr=\"author_list\")\n).values()\n# [{\"id\": 1, \"title\": \"Book 1\", \"author_list\": [...]}, ...]\n</code></pre>"},{"location":"guide/django-ninja/","title":"Django-Ninja Integration","text":"<p>The main use case for <code>django-prefetch-values</code> is APIs where data gets passed into Pydantic models. Instead of instantiating Django model instances just to serialize them, fetch values directly.</p>"},{"location":"guide/django-ninja/#example","title":"Example","text":"<pre><code># models.py\nfrom django.db import models\nfrom django_prefetch_values import PrefetchValuesQuerySet\n\n\nclass Author(models.Model):\n    name = models.CharField(max_length=100)\n    objects = PrefetchValuesQuerySet.as_manager()\n\n\nclass Book(models.Model):\n    title = models.CharField(max_length=200)\n    authors = models.ManyToManyField(Author, related_name=\"books\")\n    objects = PrefetchValuesQuerySet.as_manager()\n</code></pre> <pre><code># schemas.py\nfrom pydantic import BaseModel\n\n\nclass AuthorSchema(BaseModel):\n    id: int\n    name: str\n\n\nclass BookSchema(BaseModel):\n    id: int\n    title: str\n    authors: list[AuthorSchema]\n</code></pre> <pre><code># api.py\nfrom ninja import NinjaAPI\nfrom .models import Book\nfrom .schemas import BookSchema\n\napi = NinjaAPI()\n\n\n@api.get(\"/books\", response=list[BookSchema])\ndef list_books(request, page: int = 1, page_size: int = 100):\n    offset = (page - 1) * page_size\n    books = Book.objects.prefetch_related(\"authors\").values()[offset:offset + page_size]\n    return list(books)\n</code></pre>"},{"location":"guide/django-ninja/#why-its-faster","title":"Why It's Faster","text":"Approach Flow Standard Django DB \u2192 Django Model \u2192 dict \u2192 Pydantic django-prefetch-values DB \u2192 dict \u2192 Pydantic <p>No Django model instances are created, reducing memory usage and processing time.</p>"},{"location":"reference/api/","title":"API Reference","text":""},{"location":"reference/api/#prefetchvaluesqueryset","title":"PrefetchValuesQuerySet","text":"<p>A custom QuerySet that enables <code>.prefetch_related().values()</code> to return nested dictionaries.</p> <p>Inherits from <code>django.db.models.QuerySet</code>.</p>"},{"location":"reference/api/#setup","title":"Setup","text":"<pre><code>from django_prefetch_values import PrefetchValuesQuerySet\n\nclass MyModel(models.Model):\n    objects = PrefetchValuesQuerySet.as_manager()\n</code></pre>"},{"location":"reference/api/#valuesfields-expressions","title":"values(fields, *expressions)","text":"<p>Returns dictionaries with prefetched relations included as nested lists.</p> <pre><code>Book.objects.prefetch_related(\"authors\").values()\n# [{\"id\": 1, \"title\": \"...\", \"authors\": [{\"id\": 1, \"name\": \"...\"}, ...]}, ...]\n\nBook.objects.prefetch_related(\"authors\").values(\"id\", \"title\")\n# [{\"id\": 1, \"title\": \"...\", \"authors\": [...]}, ...]\n</code></pre>"},{"location":"reference/api/#values_listfields-flatfalse-namedfalse","title":"values_list(*fields, flat=False, named=False)","text":"<p>Returns tuples with prefetched relations included.</p>"},{"location":"reference/api/#supported-relations","title":"Supported Relations","text":"<ul> <li>ManyToManyField</li> <li>Reverse ForeignKey (ManyToOneRel)</li> <li>Reverse ManyToMany (ManyToManyRel)</li> <li>Nested Prefetches</li> </ul>"},{"location":"reference/api/#query-efficiency","title":"Query Efficiency","text":"<p>Same query count as standard Django prefetching: one query for the main model plus one per prefetch.</p> <pre><code># 2 queries: books + authors\nBook.objects.prefetch_related(\"authors\").values()\n\n# 3 queries: publishers + books + authors\nPublisher.objects.prefetch_related(\n    Prefetch(\"books\", queryset=Book.objects.prefetch_related(\"authors\"))\n).values()\n</code></pre> <p>The performance benefit comes from avoiding Django model instantiation.</p>"},{"location":"reference/changelog/","title":"Changelog","text":""},{"location":"reference/changelog/#unreleased","title":"[Unreleased]","text":""},{"location":"reference/changelog/#010","title":"[0.1.0]","text":"<ul> <li>Initial release</li> <li><code>PrefetchValuesQuerySet</code> enabling <code>.prefetch_related().values()</code> in Django ORM</li> <li>Support for ManyToMany, reverse ForeignKey, reverse ManyToMany relations</li> <li>Support for Django's <code>Prefetch</code> object with custom querysets and <code>to_attr</code></li> <li>Support for nested prefetches</li> </ul>"}]}