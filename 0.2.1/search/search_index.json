{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Django Prefetch Values","text":"<p>An experimental package exploring how to combine <code>.prefetch_related()</code> with <code>.values()</code> in Django ORM, mainly so this can be used in some test cases to evaluate whether this feature is worth the effort.</p> <p>This explores a solution to Django ticket #26565.</p>"},{"location":"#quick-example","title":"Quick Example","text":"<pre><code>from django_prefetch_values import PrefetchValuesQuerySet\n\nclass Book(models.Model):\n    title = models.CharField(max_length=200)\n    authors = models.ManyToManyField(\"Author\")\n\n    objects = PrefetchValuesQuerySet.as_manager()\n\n# Returns dicts with nested prefetched data\nbooks = Book.objects.prefetch_related(\"authors\").values()\n# [{\"id\": 1, \"title\": \"Book 1\", \"authors\": [{\"id\": 1, \"name\": \"Author 1\"}, ...]}, ...]\n</code></pre>"},{"location":"#requirements","title":"Requirements","text":"<ul> <li>Python 3.13+</li> <li>Django 5.2+</li> </ul>"},{"location":"getting-started/installation/","title":"Installation","text":""},{"location":"getting-started/installation/#supported-versions","title":"Supported Versions","text":"Python 3.13 Python 3.14 Django 5.2 \u2713 \u2713 Django 6.0 \u2713 \u2713"},{"location":"getting-started/installation/#install-from-pypi","title":"Install from PyPI","text":"<pre><code>pip install django-prefetch-values\n</code></pre> <p>Or with uv:</p> <pre><code>uv add django-prefetch-values\n</code></pre>"},{"location":"getting-started/installation/#development-installation","title":"Development Installation","text":"<pre><code>git clone https://github.com/oliverhaas/django-prefetch-values.git\ncd django-prefetch-values\nuv venv\nuv sync --group dev\n</code></pre>"},{"location":"getting-started/quickstart/","title":"Quick Start","text":""},{"location":"getting-started/quickstart/#setup","title":"Setup","text":"<p>Add <code>PrefetchValuesQuerySet</code> as your model's manager:</p> <pre><code>from django.db import models\nfrom django_prefetch_values import PrefetchValuesQuerySet\n\n\nclass Author(models.Model):\n    name = models.CharField(max_length=100)\n\n    objects = PrefetchValuesQuerySet.as_manager()\n\n\nclass Book(models.Model):\n    title = models.CharField(max_length=200)\n    authors = models.ManyToManyField(Author, related_name=\"books\")\n\n    objects = PrefetchValuesQuerySet.as_manager()\n</code></pre>"},{"location":"getting-started/quickstart/#usage","title":"Usage","text":"<pre><code># Standard Django - prefetch_related is IGNORED with values()\nbooks = Book.objects.prefetch_related(\"authors\").values()\n# [{\"id\": 1, \"title\": \"Book 1\"}, ...]  # No authors!\n\n# With django-prefetch-values - prefetched data is included\nbooks = Book.objects.prefetch_related(\"authors\").values()\n# [{\"id\": 1, \"title\": \"Book 1\", \"authors\": [{\"id\": 1, \"name\": \"Author 1\"}, ...]}, ...]\n</code></pre>"},{"location":"getting-started/quickstart/#supported-relations","title":"Supported Relations","text":"<ul> <li>ManyToMany: <code>Book.objects.prefetch_related(\"authors\").values()</code></li> <li>Reverse ForeignKey: <code>Author.objects.prefetch_related(\"books\").values()</code></li> <li>Nested: <code>Publisher.objects.prefetch_related(Prefetch(\"books\", queryset=Book.objects.prefetch_related(\"authors\"))).values()</code></li> </ul>"},{"location":"getting-started/quickstart/#prefetch-objects","title":"Prefetch Objects","text":"<pre><code>from django.db.models import Prefetch\n\n# Filter prefetched data\nBook.objects.prefetch_related(\n    Prefetch(\"authors\", queryset=Author.objects.filter(name__startswith=\"A\"))\n).values()\n\n# Custom to_attr\nBook.objects.prefetch_related(\n    Prefetch(\"authors\", to_attr=\"author_list\")\n).values()\n# [{\"id\": 1, \"title\": \"Book 1\", \"author_list\": [...]}, ...]\n</code></pre>"},{"location":"getting-started/quickstart/#use-case-api-endpoints","title":"Use Case: API Endpoints","text":"<p>The main use case is APIs where data gets passed to Pydantic models. Instead of instantiating Django models just to serialize them, fetch dicts directly:</p> Approach Flow Standard Django DB \u2192 Django Model \u2192 dict \u2192 Pydantic django-prefetch-values DB \u2192 dict \u2192 Pydantic <pre><code>from ninja import NinjaAPI\n\n@api.get(\"/books\", response=list[BookSchema])\ndef list_books(request):\n    return list(Book.objects.prefetch_related(\"authors\").values())\n</code></pre>"},{"location":"getting-started/quickstart/#benchmark","title":"Benchmark","text":"<p>The included benchmark (<code>benchmarks/benchmark.py</code>) tests fetching 1000 books, each with:</p> <ul> <li>1 publisher (ForeignKey)</li> <li>1-3 authors (ManyToMany)</li> <li>1-4 tags (ManyToMany)</li> <li>1-5 chapters (reverse ForeignKey)</li> <li>0-3 reviews (reverse ForeignKey)</li> </ul> <p>Both approaches use the same number of database queries.</p> <pre><code>uv run python benchmarks/benchmark.py\n</code></pre>"},{"location":"reference/api/","title":"API Reference","text":""},{"location":"reference/api/#prefetchvaluesqueryset","title":"PrefetchValuesQuerySet","text":"<p>A custom QuerySet that enables <code>.prefetch_related().values()</code> to return nested dictionaries.</p> <p>Inherits from <code>django.db.models.QuerySet</code>.</p>"},{"location":"reference/api/#setup","title":"Setup","text":"<pre><code>from django_prefetch_values import PrefetchValuesQuerySet\n\nclass MyModel(models.Model):\n    objects = PrefetchValuesQuerySet.as_manager()\n</code></pre>"},{"location":"reference/api/#valuesfields-expressions","title":"values(fields, *expressions)","text":"<p>Returns dictionaries with prefetched relations included as nested lists.</p> <pre><code>Book.objects.prefetch_related(\"authors\").values()\n# [{\"id\": 1, \"title\": \"...\", \"authors\": [{\"id\": 1, \"name\": \"...\"}, ...]}, ...]\n\nBook.objects.prefetch_related(\"authors\").values(\"id\", \"title\")\n# [{\"id\": 1, \"title\": \"...\", \"authors\": [...]}, ...]\n</code></pre>"},{"location":"reference/api/#values_listfields-flatfalse-namedfalse","title":"values_list(*fields, flat=False, named=False)","text":"<p>Returns tuples with prefetched relations included.</p>"},{"location":"reference/api/#supported-relations","title":"Supported Relations","text":"<ul> <li>ManyToManyField</li> <li>Reverse ForeignKey (ManyToOneRel)</li> <li>Reverse ManyToMany (ManyToManyRel)</li> <li>Nested Prefetches</li> </ul>"},{"location":"reference/api/#query-efficiency","title":"Query Efficiency","text":"<p>Same query count as standard Django prefetching: one query for the main model plus one per prefetch.</p> <pre><code># 2 queries: books + authors\nBook.objects.prefetch_related(\"authors\").values()\n\n# 3 queries: publishers + books + authors\nPublisher.objects.prefetch_related(\n    Prefetch(\"books\", queryset=Book.objects.prefetch_related(\"authors\"))\n).values()\n</code></pre> <p>The performance benefit comes from avoiding Django model instantiation.</p>"},{"location":"reference/changelog/","title":"Changelog","text":""},{"location":"reference/changelog/#unreleased","title":"[Unreleased]","text":""},{"location":"reference/changelog/#010","title":"[0.1.0]","text":"<ul> <li>Initial release</li> <li><code>PrefetchValuesQuerySet</code> enabling <code>.prefetch_related().values()</code> in Django ORM</li> <li>Support for ManyToMany, reverse ForeignKey, reverse ManyToMany relations</li> <li>Support for Django's <code>Prefetch</code> object with custom querysets and <code>to_attr</code></li> <li>Support for nested prefetches</li> </ul>"}]}